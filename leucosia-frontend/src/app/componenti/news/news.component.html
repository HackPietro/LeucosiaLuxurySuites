<app-header></app-header>

<section class="hero-title">
  <div class="hero-content">
    <h2>
      <mat-icon>article</mat-icon>
      <span *ngIf="utente?.tipologia === 'admin'; else newsUser"> Gestione News </span>
      <ng-template #newsUser> News e Aggiornamenti </ng-template>
    </h2>
    <p>Resta aggiornato sulle ultime novit√†</p>
  </div>
</section>

<div class="news-container">
  <div class="news-header">
    <div *ngIf="utenteOrAdmin() === 'admin'" class="admin-actions">
      <button class="btn btn-create" (click)="toggleCreateForm()">
        <mat-icon>add</mat-icon>
        {{ showCreateForm ? 'Annulla' : 'Nuova News' }}
      </button>
    </div>
  </div>

  <div *ngIf="showCreateForm && utenteOrAdmin() === 'admin'" class="create-news-form">
    <div class="form-container">
      <h2 class="form-title">
        <mat-icon>edit</mat-icon>
        Crea Nuova News
      </h2>

      <form (ngSubmit)="creaNews()" #newsForm="ngForm">
        <div class="form-group">
          <label for="titolo">Titolo *</label>
          <input
            type="text"
            id="titolo"
            [(ngModel)]="nuovaNews.titolo"
            name="titolo"
            placeholder="Inserisci il titolo della news"
            required
            maxlength="100">
        </div>

        <div class="form-group">
          <label for="autore">Autore *</label>
          <input
            type="text"
            id="autore"
            [(ngModel)]="nuovaNews.autore"
            name="autore"
            placeholder="Il tuo nome"
            required
            maxlength="50">
        </div>

        <div class="form-group">
          <label for="contenuto">Contenuto *</label>
          <textarea
            id="contenuto"
            [(ngModel)]="nuovaNews.contenuto"
            name="contenuto"
            placeholder="Scrivi il contenuto della news..."
            required
            rows="6"
            maxlength="1000"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="toggleCreateForm()">
            <mat-icon>close</mat-icon>
            Annulla
          </button>
          <button type="submit" class="btn btn-submit" [disabled]="!newsForm.form.valid">
            <mat-icon>save</mat-icon>
            Pubblica News
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="news-list">
    <div *ngIf="news.length === 0" class="no-news">
      <mat-icon>article</mat-icon>
      <h3>Nessuna news trovata</h3>
    </div>

    <div *ngFor="let newsItem of news" class="news-card">
      <div class="news-meta">
        <div class="news-info">
          <div class="news-author">
            <mat-icon>person</mat-icon>
            {{ newsItem.autore }}
          </div>
          <div class="news-date">
            <mat-icon>calendar_today</mat-icon>
            {{ formatDate(newsItem.data) }}
          </div>
        </div>

        <div *ngIf="utenteOrAdmin() === 'admin'" class="news-actions">
          <button class="btn-delete" (click)="newsItem.id !== undefined && eliminaNews(newsItem.id!)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div class="news-content">
        <h2 class="news-title">{{ newsItem.titolo }}</h2>
        <p class="news-text">{{ newsItem.contenuto }}</p>
      </div>
    </div>
  </div>
</div>

<div *ngIf="loading" class="loading-overlay">
  <div class="spinner"></div>
  <p>Caricamento...</p>
</div>

<div *ngIf="popupMessage" class="popup-overlay">
  <div class="popup-box">
    <p>{{ popupMessage }}</p>
    <button (click)="chiudiPopup()" class="btn btn-primary">OK</button>
  </div>
</div>

<app-footer></app-footer>
