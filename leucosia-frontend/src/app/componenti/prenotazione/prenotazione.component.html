<app-header></app-header>

<!-- Sezione titolo hero -->
<section class="hero-title">
  <div class="hero-content">
    <h2><mat-icon>bed</mat-icon> Prenota una Camera</h2>
    <p>Completa i dati per effettuare la prenotazione</p>
  </div>
</section>

<div class="messages-container">
  <form [formGroup]="prenotazioneForm" (ngSubmit)="onSubmit()" class="booking-form">

    <!-- Sezione Dettagli Prenotazione -->
    <div class="form-section">
      <h2 class="section-title">
        <mat-icon>calendar_today</mat-icon>
        Dettagli Prenotazione
      </h2>

      <div class="form-row">
        <div class="form-group">
          <label for="checkIn">Check-in *</label>
          <input
            type="date"
            id="checkIn"
            formControlName="checkIn"
            (change)="gestioneCheckInCheckOut()"
            [class.error]="controlloCampoInvalido(prenotazioneForm, 'checkIn')">
          <div class="error-message" *ngIf="controlloCampoInvalido(prenotazioneForm, 'checkIn')">
            {{ errori(prenotazioneForm, 'checkIn') }}
          </div>
        </div>

        <div class="form-group">
          <label for="checkOut">Check-out *</label>
          <input
            type="date"
            id="checkOut"
            formControlName="checkOut"
            [class.error]="controlloCampoInvalido(prenotazioneForm, 'checkOut')">
          <div class="error-message" *ngIf="controlloCampoInvalido(prenotazioneForm, 'checkOut')">
            {{ errori(prenotazioneForm, 'checkOut') }}
          </div>
        </div>
      </div>

      <div class="form-row" *ngIf="dateValide()">
        <div class="form-group">
          <label for="camera">Tipo di Camera *</label>
          <select id="camera" formControlName="camera">
            <option value="">Seleziona una camera</option>
            <option *ngFor="let camera of camere" [value]="camera.id">
              {{ camera.nome }} - {{ camera.postiLetto }} persone - €{{ camera.prezzoBase }}/notte
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Sezione Riepilogo Prezzo -->
    <div class="form-section price-summary" *ngIf="prezzoTotale > 0">
      <h2 class="section-title">
        <mat-icon>list</mat-icon>
        {{ getCameraSelezionata()?.nome }} ({{ prenotazioneForm.get('checkIn')?.value | date:'dd/MM/yyyy'}} - {{ prenotazioneForm.get('checkOut')?.value | date:'dd/MM/yyyy'}})
      </h2>

      <div class="price-details">
        <div *ngIf="prezziGiornalieri.length > 0" class="daily-prices">
          <div class="price-row" *ngFor="let giorno of prezziGiornalieri">
            <span>{{ giorno.data | date:'dd/MM/yyyy' }}</span>
            <span class="price">€{{ giorno.prezzo.toFixed(2) }}</span>
          </div>
        </div>

        <hr />

        <!-- Totale con sovrapprezzo accanto -->
        <div class="price-row">
          <span><strong>Periodo: {{ numeroNotti }} notte/i</strong></span>
          <span class="price">
            <strong>
              <span *ngIf="sovrapprezzoSpese > 0">
                Totale: €{{ (prezzoTotale).toFixed(2) }} (incluso +10% sovrapprezzo spese)
              </span>
            </strong>
          </span>
        </div>
      </div>
    </div>

    <!-- Sezione Metodo di Pagamento -->
    <div class="form-section" *ngIf="prezzoTotale > 0">
      <h2 class="section-title">
        <mat-icon>payment</mat-icon>
        Metodo di Pagamento
      </h2>

      <div class="payment-methods">
        <div class="payment-option">
          <input
            type="radio"
            id="contanti"
            formControlName="metodoPagamento"
            value="contanti">
          <label for="contanti" class="payment-label">
            <mat-icon>money</mat-icon>
            <div>
              <strong>Pagamento in Contanti</strong>
              <small>Pagherai al check-in presso la struttura</small>
            </div>
          </label>
        </div>
      </div>
    </div>

    <!-- Pulsante di Invio -->
    <div class="form-actions" *ngIf="prezzoTotale > 0">
      <button type="submit" class="btn btn-primary btn-large">
        <mat-icon>check</mat-icon>
        Conferma Prenotazione
        <span class="btn-price">€{{ prezzoTotale.toFixed(2) }}</span>
      </button>
    </div>
  </form>
</div>

<!-- Popup Messaggio -->
<div *ngIf="popupMessage" class="popup-overlay">
  <div class="popup-box">
    <p>{{ popupMessage }}</p>
    <button (click)="chiudiPopup()" class="btn btn-primary">OK</button>
  </div>
</div>

<app-footer></app-footer>
